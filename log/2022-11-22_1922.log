**********************
Windows PowerShell トランスクリプト開始
開始時刻: 20221122192215
ユーザー名: JBS\kitamurat
RunAs ユーザー: JBS\kitamurat
構成名: 
コンピューター: W1051663N211 (Microsoft Windows NT 10.0.19042.0)
ホスト アプリケーション: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
プロセス ID: 13092
PSVersion: 5.1.19041.1682
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.19041.1682
BuildVersion: 10.0.19041.1682
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
トランスクリプトが開始されました。出力ファイル: .\log\2022-11-22_1922.log
 Subscription:
CP-CP2Dept (b0da899c-406c-4ebc-b7d5-0f9286d42d1e) - cc7dee35-16af-4e40-a4d4-2619d7c0024f - kitamurat@jbs.com
|
|
|
| - - - - - - - - - - - - - -
|  VirtualNetwork
| - - - - - - - - - - - - - -
.\csv\nw_parameter.csv

vNet_name vNet_resourceGroup location  range
--------- ------------------ --------  -----
vnetweb01 rg0102             japaneast 192.168.0.0/24
vnetweb01 rg0102             japaneast 192.168.0.0/24
vnetweb01 rg0102             japaneast 192.168.0.0/24


|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| VNET [ vnetweb01 ] already exists.
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| VNET [ vnetweb01 ] already exists.
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| VNET [ vnetweb01 ] already exists.
|
| function add_VirtualNetwork completed.
|
|
|
| - - - - - - - - - - - - - -
|  NSG
| - - - - - - - - - - - - - -

vNet_name vNet_resourceGroup subnetNames       NSG_names   NSG_resourceGroups
--------- ------------------ -----------       ---------   ------------------
vnetweb01 rg0102             subnet01          nsg01       rg0102
vnetweb01 rg0102             subnet01          nsg01       rg0102
vnetweb01 rg0102             subnet02;subnet03 nsg02;nsg03 rg0102;rg0102


|
| RESOURCEGROUP [ rg0102 ] already exists.
|
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
|
| function add_NSG completed.
|
|
|
| - - - - - - - - - - - - - -
|  Subnet
| - - - - - - - - - - - - - -

vNet_name vNet_resourceGroup subnetNames       subnetRanges                     NSG_names
--------- ------------------ -----------       ------------                     ---------
vnetweb01 rg0102             subnet01          192.168.0.0/26                   nsg01
vnetweb01 rg0102             subnet01          192.168.0.0/26                   nsg01
vnetweb01 rg0102             subnet02;subnet03 192.168.0.64/26;192.168.0.128/25 nsg02;nsg03


|
| function add_Subnet completed.
|
|
|
| - - - - - - - - - - - - - -
|  AvailabilitySet
| - - - - - - - - - - - - - -
.\csv\availability_parameter.csv

AvailabilitySet vm_resourceGroup Location  UpdateDomain FaultDomain ProximityPlacementGroup
--------------- ---------------- --------  ------------ ----------- -----------------------
asweb           rg0102           japaneast 5            2           ppgweb


|
| RESOURCEGROUP [ rg0102 ] already exists.
|
情報: Loaded Module 'Az.Compute'
| -- Proximity_Placement_Group [ ppgweb ] --
|
| ProximityPlacementGroup [ ppgweb ] deploying...
| ProximityPlacementGroup ResourceID:
/subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/proximityPlacementGroups/ppgweb
|
| -- Availability_Set [ asweb ] --
|
| AvailabilitySet [ asweb ] deploying...
| AvailabilitySet ResourceID:
/subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/availabilitySets/asweb
|
| function add_AvailabilitySet completed.
|
|
|
| - - - - - - - - - - - - - -
|  NetworkSecurityRule
| - - - - - - - - - - - - - -
.\csv\nsg_parameter.csv

nsgName nsgResourceGroup ruleName       access protocol direction priority sourceAddresses sourcePorts destAddresses
------- ---------------- --------       ------ -------- --------- -------- --------------- ----------- -------------
nsg01   rg0102           Allow80and443  allow  TCP      inbound   1000     10.0.0.0/16     *           192.168.0.0/26
nsg02   rg0102           Allow1433      allow  TCP      inbound   1000     192.168.0.0/26  *           192.168.0.64/26
nsg03   rg0102           DenyAllInbound deny   *        inbound   4096     *               *           *


|
| -- Azure_Network_Security_Group [ nsg01 ] --
|
| Rule [ Allow80and443 ]:

|
| -- Azure_Network_Security_Group [ nsg02 ] --
|
| Rule [ Allow1433 ]:

Name                     : Allow80and443
Direction                : Inbound
Access                   : Allow
Priority                 : 1000
Protocol                 : TCP
DestinationPortRange     : {80, 443}
SourceAddressPrefix      : {10.0.0.0/16}
DestinationAddressPrefix : {192.168.0.0/26}

Name                     : Allow1433
Direction                : Inbound
Access                   : Allow
Priority                 : 1000
Protocol                 : TCP
DestinationPortRange     : {1433}
SourceAddressPrefix      : {192.168.0.0/26}
DestinationAddressPrefix : {192.168.0.64/26}

|
| -- Azure_Network_Security_Group [ nsg03 ] --
|
| Rule [ DenyAllInbound ]:
Name                     : DenyAllInbound
Direction                : Inbound
Access                   : Deny
Priority                 : 4096
Protocol                 : *
DestinationPortRange     : {*}
SourceAddressPrefix      : {*}
DestinationAddressPrefix : {*}

|
| function add_NetworkSecurityRule completed.
|
|
|
| - - - - - - - - - - - - - -
|  VM_NIC
| - - - - - - - - - - - - - -
.\csv\nw_parameter.csv



vm_name vNet_name subnetNames       subnetRanges                     ipAddress
------- --------- -----------       ------------                     ---------
vmweb01 vnetweb01 subnet01          192.168.0.0/26                   192.168.0.11
vmweb02 vnetweb01 subnet01          192.168.0.0/26                   192.168.0.12
vmdb01  vnetweb01 subnet02;subnet03 192.168.0.64/26;192.168.0.128/25 192.168.0.101


|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| -- Azure_Virtual_Machines [ vmweb01 ] --
|
| NIC [ vmweb01-NIC1 ] deploying...
| NIC ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Network/networkInterfaces/vmweb01-NIC1
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| -- Azure_Virtual_Machines [ vmweb02 ] --
|
| NIC [ vmweb02-NIC1 ] deploying...
| NIC ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Network/networkInterfaces/vmweb02-NIC1
|
| RESOURCEGROUP [ rg0102 ] already exists.
|
| -- Azure_Virtual_Machines [ vmdb01 ] --
|
| NIC [ vmdb01-NIC1 ] deploying...
| NIC ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Network/networkInterfaces/vmdb01-NIC1
|
| function add_NetworkInterface completed.
|
|
|
| - - - - - - - - - - - - - -
|  VM
| - - - - - - - - - - - - - -
.\csv\vm_parameter.csv

vm_name vm_resourceGroup vm_size         vmOsDisk_type vmOsDisk_size vmDataDisks_type vmDataDisks_size ImageName
------- ---------------- -------         ------------- ------------- ---------------- ---------------- ---------
vmweb01 rg0102           Standard_F2s_v2 Standard_LRS  32
vmweb02 rg0102           Standard_F2s_v2 Standard_LRS  32
vmdb01  rg0102           Standard_F2s_v2 Standard_LRS  32            StandardSSD_LRS  64               win2016-image


|
| -- Azure_Virtual_Machines [ vmweb01 ] --
|
| VM [ vmweb01 ]'s OS Version infomation as follows.
Windows
MicrosoftWindowsServer
WindowsServer2019-datacenter-smalldisk-g2
|
| VM [ vmweb01 ] deploying...
| VM ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/virtualMachines/vmweb01
|
| -- Azure_Virtual_Machines [ vmweb02 ] --
|
| VM [ vmweb02 ]'s OS Version infomation as follows.
Windows
MicrosoftWindowsServer
WindowsServer2019-datacenter-smalldisk-g2
|
| VM [ vmweb02 ] deploying...
| VM ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/virtualMachines/vmweb02
|
| -- Azure_Virtual_Machines [ vmdb01 ] --
|
Get-AzImage : Resource group 'rg01' could not be found.
ErrorCode: ResourceGroupNotFound
ErrorMessage: Resource group 'rg01' could not be found.
ErrorTarget: 
StatusCode: 404
ReasonPhrase: Not Found
OperationID : 6d12211a-303d-4ba3-a824-364bd70036b6
発生場所 C:\Users\kitamurat\pshome\AzureIaaSdeployPSscript\func\add_VM.ps1:121 文字:26
+ ...    $image = Get-AzImage -ImageName $imageName -ResourceGroup $imageRe ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : CloseError: (:) [Get-AzImage]、ComputeCloudException
    + FullyQualifiedErrorId : Microsoft.Azure.Commands.Compute.Automation.GetAzureRmImage
Get-AzImage : Resource group 'rg01' could not be found.
ErrorCode: ResourceGroupNotFound
ErrorMessage: Resource group 'rg01' could not be found.
ErrorTarget:
StatusCode: 404
ReasonPhrase: Not Found
OperationID : 6d12211a-303d-4ba3-a824-364bd70036b6
発生場所 C:\Users\kitamurat\pshome\AzureIaaSdeployPSscript\func\add_VM.ps1:121 文字:26
+ ...    $image = Get-AzImage -ImageName $imageName -ResourceGroup $imageRe ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : CloseError: (:) [Get-AzImage]、ComputeCloudException
    + FullyQualifiedErrorId : Microsoft.Azure.Commands.Compute.Automation.GetAzureRmImage

| -- Error -- IMAGE [ win2016-image ] not found in [ rg01 ].
| function add_VM completed.
|
|
|
| - - - - - - - - - - - - - -
|  StorageAccount
| - - - - - - - - - - - - - -
.\csv\storage_parameter.csv

storageName     storageResourceGroup location  sku          bootdiag_vmNames vmResourceGroups flowlog_nsgs nsgResourceGroups RetentionInDays
-----------     -------------------- --------  ---          ---------------- ---------------- ------------ ----------------- ---------------
vmweb0102bootst rg0102               japaneast Standard_LRS vmweb01;vmweb02  rg0102;rg0102
vmweb0102flowst rg0102               japaneast Standard_LRS                                   nsg01        rg0102            90


|
| RESOURCEGROUP [ rg0102 ] already exists.
|
PS>終了エラー(Invoke-WebRequest): "リモート名を解決できませんでした。: 'vmweb0102bootst.blob.core.windows.net'"
| -- Azure_Storage_Account [ vmweb0102bootst ] --
|
| STORAGE [ vmweb0102bootst ] deploying...
| STORAGE ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Storage/storageAccounts/vmweb0102bootst
|
| -- Set-AzVMBootDiagnostic [ vmweb01 ] with Custom Storage Account --
|

| BootDiagnosticSettings:

ResourceGroupName        : rg0102
Id                       : /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/virtualMachines/vmweb01
VmId                     : a0ba17bc-ca5c-44db-88e1-a5c73c5406a8
Name                     : vmweb01
Type                     : Microsoft.Compute/virtualMachines
Location                 : japaneast
Tags                     : {}
AvailabilitySetReference : {Id}
DiagnosticsProfile       : {BootDiagnostics}
HardwareProfile          : {VmSize}
NetworkProfile           : {NetworkInterfaces}
OSProfile                : {ComputerName, AdminUsername, WindowsConfiguration, Secrets, AllowExtensionOperations, RequireGuestProvisionSignal}
ProvisioningState        : Succeeded
StorageProfile           : {ImageReference, OsDisk, DataDisks}
ProximityPlacementGroup  : {Id}


Enabled    : True
StorageUri : https://vmweb0102bootst.blob.core.windows.net/

|
| -- Set-AzVMBootDiagnostic [ vmweb02 ] with Custom Storage Account --
|

ResourceGroupName        : rg0102
Id                       : /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Compute/virtualMachines/vmweb02
VmId                     : bac4b4ae-eb89-447b-8d94-a1ba6f021b42
Name                     : vmweb02
Type                     : Microsoft.Compute/virtualMachines
Location                 : japaneast
Tags                     : {}
AvailabilitySetReference : {Id}
DiagnosticsProfile       : {BootDiagnostics}
HardwareProfile          : {VmSize}
NetworkProfile           : {NetworkInterfaces}
OSProfile                : {ComputerName, AdminUsername, WindowsConfiguration, Secrets, AllowExtensionOperations, RequireGuestProvisionSignal}
ProvisioningState        : Succeeded
StorageProfile           : {ImageReference, OsDisk, DataDisks}
ProximityPlacementGroup  : {Id}

| BootDiagnosticSettings:

Enabled    : True
StorageUri : https://vmweb0102bootst.blob.core.windows.net/

|
| RESOURCEGROUP [ rg0102 ] already exists.
|
PS>終了エラー(Invoke-WebRequest): "リモート名を解決できませんでした。: 'vmweb0102flowst.blob.core.windows.net'"
| -- Azure_Storage_Account [ vmweb0102flowst ] --
|
| STORAGE [ vmweb0102flowst ] deploying...
| STORAGE ResourceID:
| /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Storage/storageAccounts/vmweb0102flowst
|
| -- Set-AzNetworkWatcherConfigFlowLog [nsg01] --
|
| FlowLogSettings:

Enabled                        : True
RetentionPolicy                : Microsoft.Azure.Commands.Network.Models.PSRetentionPolicyParameters
Format                         : Microsoft.Azure.Commands.Network.Models.PSFlowLogFormatParameters
StorageId                      : /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Storage/storageAccounts/vmweb0102flowst
TargetResourceId               : /subscriptions/b0da899c-406c-4ebc-b7d5-0f9286d42d1e/resourceGroups/rg0102/providers/Microsoft.Network/networkSecurityGroups/nsg01
FlowAnalyticsConfiguration     : Microsoft.Azure.Commands.Network.Models.PSTrafficAnalyticsProperties
RetentionPolicyText            : {
                                   "Days": 90,
                                   "Enabled": true
                                 }
FormatText                     : {
                                   "Type": "JSON",
                                   "Version": 2
                                 }
FlowAnalyticsConfigurationText : {}

|
| function add_StorageAccount completed.
|
|
|
| - - - - - - - - - - - - - -
|  VM_Backup
| - - - - - - - - - - - - - -
.\csv\backup_parameter.csv



vmName  vmRg   RecoveryServicesName RecoveryServicesRg policyName   scheduleRunFrequency scheduleRunTimes instantRpRetentionRangeInDays count weeklySchedule
------  ----   -------------------- ------------------ ----------   -------------------- ---------------- ----------------------------- ----- --------------
vmweb01 rg0102 rsc01                rg0001             WeeklyPolicy Weekly               3:00             5                             1     Sunday
vmdb01  rg0102 rsc01                rg0001             DailyPolicy  Daily                2:00             2                             7


|
| Canceled.
|
|
|
| COMPLETE.
|
**********************
Windows PowerShell トランスクリプト終了
終了時刻: 20221122193406
**********************
